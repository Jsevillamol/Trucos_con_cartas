int valor(tMazo mano)
{
	int total = 0;
	bool hay_un_as = false;
	for (int i = 0; i < mano.cuantas; i++)
	{
		total += (int) mano.cartas[i].num
		if (mano.cartas[i].num == A) hay_un_as == true;
	}
	
	if (hay_un_as && total <= 11) return total + 10; //El as puede valer 1 o 11, según nos convenga.
	else return total;

}


int opciones_de_blackjack()
{
	cout << "Que decides hacer?:" << endl
	     << "1 - Pedir"           << endl
	     << "2 - Plantarse"       << endl
	     << "3 - Doblar apuesta"  << endl
		 //<< "4 - Dividir "        << endl
	     << "0 - Abandonar"       << endl;
		 
	return digitoEntre(0,4);
}

void repartir_n_cartas(tMazo &mazo, tMazo &mazoJugador, int cuantasQuieres, int &cont) 
//cont evita que siempre repartamos las mismas cartas.
{
	for (int i=0; i < cuantasQuieres; i++)
		mazoJugador.cartas[mazoJugador.cuantas++] = mazo[cont++];
}

int apuesta()
{
	cout << "Cuanto quieres apostar?" << endl;
	
	return digitoEntre(APU_MIN,APU_MAX);
}

void blackjack()
{
	tMazo mazoJugador, mazoBot, mazoJug1, mazoJug2;
	int queHacer, dinero = DINERO_INI, apu;
	bool pasa_jug=false, pasa_crup=false;
	
	cargar_mazo_completo();
	
	//Aqui comienza una mano. Un juego se compone de muchas manos, amirite?{
	barajar(mazo);
	
	cont = 0; //La inicialización de cont hay que hacerla aquí
	
	repartir_n_cartas(mazo, mazoJugador, 2, cont); //Si aquí le pasas un literal, no se asigna a cont.
	repartir_n_cartas(mazo, mazoBot, 2, cont);     
	
	cout << "Carta del crupier:" << endl;
	mostrar(mazoBot.carta[1]);
	
	cout << "Mano actual:" << endl;
	mostrar(mazoJugador);
	
	apu = apuesta();
	dinero -= apu;
	
	//Antes de comenzar a jugar hay que comprobar que ni el crupier ni el jugador tengan 21 o más
	while((valor(manoJugador) < 21) && (valor(manoCrupier) < 21) && (pasa_jug && pasa_crup))
	{
		//Siempre empieza el jugador
		
		queHacer = opciones_de_blackjack();
		
		if      (queHacer == 1)
		{
			repartir_n_cartas(mazo, mazoJugador, 1, cont);
			
			cout << "Mano actual:" << endl;
			mostrar(mazoJugador);
		}
		/*else if (queHacer == 2)
		{
			pasa_jug = true;
		}*/
		else if (queHacer == 3)
		{
			if (mazoJugador.cartas > 2)
			{
				cout << "Error, no puedes doblar la apuesta si ya has pedido otra carta" << endl;
			}
			else 
			{
				apu *= 2;
				dinero -= (apu/2);
			}
			
			if (queHacer == 2) pasa_jug = true; else pasa_jug = false;
		}
		/*else if (queHacer == 4)
		{
			if (mazoJugador.cartas > 2)
			{
				cout << "Error, no puedes dividir la mano si ya has pedido otra carta" << endl;
			}
			else if (mazoJugador.cartas[0] != mazoJugador.cartas[1])
			{
				cout << "Error, no puedes dividir la mano si tus dos cartas no son iguales" << endl;
			}
			else
			{
				mazoJug1.cartas[0] = mazoJugador.cartas[0];
				mazoJug2.cartas[0] = mazoJugador.cartas[1];
					
				repartir_n_cartas(mazo, mazoJug1, 1, cont);				
				repartir_n_cartas(mazo, mazoJug2, 1, cont);
				
				apu *= 2;
			}
			la division es complicada. dejemosla para luego*/ 
	
	//Turno crupier
	{
		while (valor(manoCrupier) < 17)
		{
			repartir_n_cartas(mazo, mazoBot, 1, cont);
		}
	}
}
